using System.Collections;
using System.Collections.Generic;
using Chromia.Postchain.Ft3;
using UnityEngine;
using System.Text.RegularExpressions;
using System.Linq;
using System;


public class SSODemoScript : MonoBehaviour
{
    [SerializeField] private string _blockchainRID;
    [SerializeField] private string _baseURL;

    const string txRaw = "http://localhost:3000/?rawTx=A582030A30820306A58202B6308202B2A12204201A3A5B4C919798B52292094185B37E71898CC245FA9F0AC51A33B473150FE889A582023C30820238A581D63081D3A21A0C186674332E6465765F72656769737465725F6163636F756E74A581B43081B1A581AE3081ABA2030C0153A5483046A2440C42303364663064333232333864323130303031663164656637373464393031303132343565343235633839353366623435373061633630313961303665373163633732A5563054A50C300AA2030C0141A2030C0154A2440C42303364663064333232333864323130303031663164656637373464393031303132343565343235633839353366623435373061633630313961303665373163633732A0020500A582015B30820157A2190C176674332E6164645F617574685F64657363726970746F72A582013830820134A2420C4036376331646431316332393630613836663261663933633939626538326333353530303734353839636234366531383564346538363030316439376464646466A2420C4036376331646431316332393630613836663261663933633939626538326333353530303734353839636234366531383564346538363030316439376464646466A581A93081A6A2030C0153A5483046A2440C42303236383938363639313435383863373037323664616332363961313837323065643939373232613663633961363530623037326366366630303665373832666537A551304FA5073005A2030C0154A2440C42303236383938363639313435383863373037323664616332363961313837323065643939373232613663633961363530623037326366366630303665373832666537A0020500A54C304AA123042103DF0D32238D210001F1DEF774D90101245E425C8953FB4570AC6019A06E71CC72A123042102689866914588C70726DAC269A18720ED99722A6CC9A650B072CF6F006E782FE7A54A3048A1420440817A1F4FD3287929363182E0DDDD82F644C147790209189FEFFA4F31C78544ED28395579B0C588FDDB85FFDA103AC2DC85521B1DA641EE6DBF9DA8083E2332CBA1020400";


    private void Start()
    {
        StartCoroutine(SSODemo());
    }

    public IEnumerator SSODemo()
    {
        Postchain postchain = new Postchain(_baseURL);
        Blockchain blockchain = null;

        yield return postchain.Blockchain<Blockchain>(_blockchainRID,
        (Blockchain _blockchain) =>
        {
            Debug.Log(_blockchain.Info.Name);
            blockchain = _blockchain;
        }, (string error) => { Debug.Log(error); });

        SSO sso = new SSO(blockchain, new SSOStoreLocalStorage());
        SSO.VaultUrl = "https://dev.vault.chromia-development.com";

        yield return sso.PendingSSO(
            ((Account, User) ac) =>
            {
                Debug.Log(ac.Item1.Id);
            },
            () =>
            {
                sso.InitiateLogin("http://localhost:3000", "http://localhost:3000");
            }
        );
    }

}